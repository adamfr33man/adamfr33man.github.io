var U=Object.defineProperty,H=Object.defineProperties;var K=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var _=(e,t,r)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a=(e,t)=>{for(var r in t||(t={}))Q.call(t,r)&&_(e,r,t[r]);if(F)for(var r of F(t))X.call(t,r)&&_(e,r,t[r]);return e},s=(e,t)=>H(e,K(t));import{j as n,B as W,A as Y,a as h,T as Z,I as ee,d as ne,b as N,c as L,L as G,e as C,f as w,g as M,h as R,i as j,r as y,G as $,k as te,l as re,m as oe,n as b,F as ce,o as ae,C as se,p as ie,q as le,s as D,t as de,u as ue,D as V,S as pe,R as q,O as me,v as he,w as Se,x as ge,y as fe,z as ye}from"./vendor.808464f4.js";const ve=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&l(i)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerpolicy&&(c.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?c.credentials="include":o.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function l(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}};ve();const Ce=({connection:e,onConnectClick:t,onMenuClick:r})=>n(W,{sx:{flexGrow:1},children:n(Y,{position:"static",children:h(Z,{children:[n(ee,{size:"large",edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},onClick:()=>r(),children:n(ne,{})}),n(N,{variant:"h6",component:"div",sx:{flexGrow:1},children:"OBS Web remote"}),n(L,{color:"inherit",onClick:()=>t(),children:e==="connected"?"Disconnect":"Connect"})]})})}),be=({name:e,items:t,onSceneItemEnabledClick:r})=>{const l=e;return n(G,{component:"div",disablePadding:!0,children:t.map(({id:o,name:c,enabled:i})=>h(C,{sx:{pl:4},children:[n(w,{onClick:()=>r({sceneName:l,sceneItemId:o,sceneItemEnabled:!i}),children:i?n(M,{color:"primary"}):n(R,{color:"error"})}),n(j,{primary:c})]},`sceneItem-${o}`))})},we=({scenes:e,activeName:t,transition:r,onSceneClick:l,onSceneItemEnabledClick:o})=>{const[c,i]=y.exports.useState([]),{to:m,duration:T}=r,x=g=>{c.includes(g)?i(c.filter(v=>v!==g)):i([...c,g])};return h($,{item:!0,xs:12,md:6,children:[n(N,{sx:{mt:4,mb:2},variant:"h6",component:"div",children:"Scenes"}),n(G,{dense:!1,children:e.map(({id:g,name:v,items:I})=>{const E=t===v;c.includes(g);const d=n(ie,{edge:"start",tabIndex:-1,checked:E,onClick:S=>{S.stopPropagation(),l({sceneName:v})},disabled:!!m});return h(te,{disableGutters:!0,children:[n(re,{expandIcon:n(oe,{onClick:()=>x(g)}),"aria-controls":"panel1a-content",id:"panel1a-header",children:h(b,{component:"div",disablePadding:!0,children:[n(w,{children:m&&m===v?n(ce,{in:!0,appear:!0,timeout:T,easing:{enter:"ease-in-out",exit:"ease-out"},children:d},g):d}),n(j,{children:n(N,{component:"div",children:v})})]})}),n(ae,{style:{backgroundColor:"#f3f2f3"},children:n(se,{children:n(be,{name:v,items:I,onSceneItemEnabledClick:o})})})]},g)})})]})},xe=({settings:e,onSettingsChanged:t,onClose:r})=>{const[l,o]=y.exports.useState(e),[c,i]=y.exports.useState(e.connectOnStartup);return n(W,{sx:{pt:4,pb:4},children:h(G,{children:[n(C,{children:n(N,{variant:"h6",component:"div",children:"Settings"})}),h(C,{children:[n(w,{children:n(le,{})}),n(b,{children:n(D,{id:"outlined",label:"IP/Hostname",defaultValue:e.ip,onChange:m=>o(s(a({},l),{ip:m.currentTarget.value}))})})]}),h(C,{children:[n(w,{children:n(de,{})}),n(b,{children:n(D,{label:"Port",defaultValue:e.port,onChange:m=>o(s(a({},l),{port:parseInt(m.currentTarget.value)}))})})]}),h(C,{children:[n(w,{children:n(ue,{})}),n(b,{children:n(D,{label:"Password",defaultValue:e.password,onChange:m=>o(s(a({},l),{password:m.currentTarget.value}))})})]}),n(V,{}),h(C,{children:[n(w,{children:n(pe,{checked:c,onChange:m=>i(m.target.checked)})}),n(b,{children:"Connect on Startup"})]}),n(V,{}),n(b,{children:h($,{container:!0,spacing:2,children:[n($,{item:!0,xs:6,children:n(L,{variant:"outlined",color:"error",onClick:()=>r(),children:"Reset"})}),n($,{item:!0,xs:6,children:n(L,{variant:"contained",color:"primary",onClick:()=>t(s(a({},l),{connectOnStartup:c})),children:"Save"})})]})})]})})};class Ie extends q.Component{constructor(t){super(t);this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?n("h1",{children:"Something went wrong."}):this.props.children}}const p=new me,A={version:"1.0",ip:window.location.hostname,port:4455,password:"",connectOnStartup:!1},z=e=>{localStorage.setItem("settings",JSON.stringify(e))},Ee=()=>{try{const e=localStorage.getItem("settings");return e?JSON.parse(e):(console.warn("No stored settings, making defaults"),z(A),A)}catch{return console.warn("Unable to load settings, using defaults"),A}},B={connection:"disconnected",error:void 0,scenes:[],activeSceneName:"",settings:Ee(),transition:{duration:0,from:void 0,to:void 0}},Ne=(e,t)=>{switch(t.type){case"connectionError":return s(a({},e),{error:t.payload.message});case"connecting":return s(a({},e),{connection:"connecting"});case"connected":{console.log("CONNECTED",t);const{scenes:r,activeSceneName:l,transition:o}=t.payload;return s(a({},e),{connection:"connected",error:void 0,scenes:r,activeSceneName:l,transition:o})}case"disconnected":return s(a({},B),{connection:"disconnected"});case"currentSceneChanged":{const{newSceneName:r}=t.payload;return r!==e.activeSceneName?s(a({},e),{activeSceneName:t.payload.newSceneName}):e}case"transitionDurationChanged":return s(a({},e),{transition:s(a({},e.transition),{duration:e.transition.duration})});case"selectScene":{const{sceneName:r}=t.payload;return p.call("SetCurrentProgramScene",{sceneName:r}),s(a({},e),{activeSceneName:r,transition:s(a({},e.transition),{from:e.activeSceneName,to:r})})}case"transitionStarted":return e.activeSceneName!==e.transition.from?s(a({},e),{transition:s(a({},e.transition),{from:e.activeSceneName})}):e;case"transitionCompleted":{const{from:r,to:l}=e.transition;return r||l?s(a({},e),{transition:s(a({},e.transition),{from:void 0,to:void 0})}):e}case"setSceneItemEnabled":return p.call("SetSceneItemEnabled",t.payload),e;case"updateSceneItems":{const{sceneName:r,items:l}=t.payload,o=e.scenes.find(i=>i.name===r);if(!o)throw new Error(`Could not update scene ${r}`);const c=e.scenes.map(i=>i.id===o.id?s(a({},o),{items:l}):i);return s(a({},e),{scenes:c})}case"updateSceneItemEnabled":{const{sceneName:r,sceneItemId:l,sceneItemEnabled:o}=t.payload,c=e.scenes.map(i=>i.name===r?s(a({},i),{items:i.items.map(m=>m.id===l?s(a({},m),{enabled:o}):m)}):i);return s(a({},e),{scenes:c})}case"updateSettings":{const{settings:r}=t.payload;return z(r),p.disconnect(),s(a({},B),{settings:r})}default:throw new Error(`Unhandled action type: ${t}`)}},ke=()=>{const[e,t]=y.exports.useReducer(Ne,B),[r,l]=y.exports.useState(!1),{error:o}=e,c=["EW/ATV Fullscreen"],i="EW/ATV",m=()=>{const d=[];return e.scenes.forEach(S=>{if(c.includes(S.name))return!1;{const u=S.items.find(f=>i===f.name);u&&d.push({sceneName:S.name,sceneItemId:u.id,enabled:u.enabled})}}),d},T=()=>{m().forEach(({sceneName:d,sceneItemId:S,enabled:u})=>{console.log(`Should flip ${S} on ${d} which is ${u} vs ${r}`),p.call("SetSceneItemEnabled",{sceneName:d,sceneItemId:S,sceneItemEnabled:r})}),l(!r)},x=y.exports.useCallback(()=>{(async()=>{t({type:"connecting"});const{ip:d,port:S,password:u}=e.settings;console.log("Let's go!!!");try{const{obsWebSocketVersion:f}=await p.connect(`ws://${d}:${S}/`,u);console.log(`Connected to server ${f}`)}catch(f){console.error(f),t({type:"connectionError",payload:{message:`Could not connect to ${d} on ${S}. Message: ${f}`}})}})()},[e,t]),g=y.exports.useCallback(()=>(async()=>{await p.disconnect(),t({type:"disconnected"})})(),[t]),v=y.exports.useCallback(()=>{e.connection==="connected"?g():x()},[e,x,g]);y.exports.useEffect(()=>{e.settings.connectOnStartup&&x();const d=async u=>{const{sceneItems:f}=await p.call("GetSceneItemList",{sceneName:u});return(await Promise.all(f.map(async({sourceName:P,sceneItemId:k,sceneItemIndex:O})=>({id:k,index:O,name:P,enabled:(await p.call("GetSceneItemEnabled",{sceneName:u,sceneItemId:k})).sceneItemEnabled})))).reverse()},S=async()=>{const{currentProgramSceneName:u,scenes:f}=await p.call("GetSceneList"),P=(await Promise.all(f.map(async({sceneName:O,sceneIndex:J})=>({id:J,name:O,items:await d(O)})))).reverse(),{transitionDuration:k}=await p.call("GetCurrentSceneTransition");t({type:"connected",payload:{scenes:P,activeSceneName:u,transition:{duration:k,from:void 0,to:void 0}}})};p.on("Identified",async()=>S()),p.on("CurrentProgramSceneChanged",({sceneName:u})=>{t({type:"currentSceneChanged",payload:{newSceneName:u}}),d(u)}),p.on("SceneItemEnableStateChanged",u=>t({type:"updateSceneItemEnabled",payload:u})),p.on("SceneTransitionStarted",()=>t({type:"transitionStarted"})),p.on("SceneTransitionEnded",()=>t({type:"transitionCompleted"})),p.on("CurrentSceneTransitionDurationChanged",({transitionDuration:u})=>t({type:"transitionDurationChanged",payload:{duration:u}})),p.on("SceneListChanged",()=>S()),p.on("ExitStarted",()=>t({type:"disconnected"}))},[]);const[I,E]=y.exports.useState(!1);return h(Ie,{children:[n(Ce,{connection:e.connection,onConnectClick:v,onMenuClick:()=>E(!I)}),n(he,{anchor:"left",open:I,children:n(xe,{settings:e.settings,onClose:()=>E(!I),onSettingsChanged:d=>{E(!1),t({type:"updateSettings",payload:{settings:d}})}})}),h(Se,{sx:{mt:4,mb:4},children:[o&&n(ge,{variant:"filled",severity:"error",children:o}),e.connection==="connected"?h(fe,{children:[h(L,{variant:"contained",color:r?"error":"primary",onClick:()=>T(),children:[r?n(R,{}):n(M,{})," ","Overlays ",r?"off":"on"]}),n(we,{scenes:e.scenes,activeName:e.activeSceneName,transition:e.transition,onSceneClick:d=>t({type:"selectScene",payload:d}),onSceneItemEnabledClick:d=>t({type:"setSceneItemEnabled",payload:d})})]}):n(N,{variant:"h4",component:"div",sx:{flexGrow:1},children:e.connection==="connecting"?"Connecting...":"Not Connected"})]})]})};ye.render(n(q.StrictMode,{children:n(ke,{})}),document.getElementById("root"));
