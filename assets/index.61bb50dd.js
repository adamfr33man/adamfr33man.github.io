var K=Object.defineProperty,Q=Object.defineProperties;var X=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var W=(e,t,r)=>t in e?K(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,s=(e,t)=>{for(var r in t||(t={}))Y.call(t,r)&&W(e,r,t[r]);if(R)for(var r of R(t))Z.call(t,r)&&W(e,r,t[r]);return e},i=(e,t)=>Q(e,X(t));import{j as n,B as M,A as ee,a as h,T as ne,I as te,d as re,b as k,c as A,O as oe,r as g,F as B,L as V,e as C,f as x,g as j,h as q,i as z,G as $,k as ce,l as ae,m as se,n as I,o as ie,p as le,C as de,q as ue,s as pe,t as L,u as he,v as me,D as _,S as F,w as fe,R as H,x as Se,y as ge,z as ve,E as ye}from"./vendor.4bb26846.js";const we=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&a(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerpolicy&&(c.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?c.credentials="include":o.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function a(o){if(o.ep)return;o.ep=!0;const c=r(o);fetch(o.href,c)}};we();const Ce=({connection:e,onConnectClick:t,onMenuClick:r})=>n(M,{sx:{flexGrow:1},children:n(ee,{position:"static",children:h(ne,{children:[n(te,{size:"large",edge:"start",color:"inherit","aria-label":"menu",sx:{mr:2},onClick:()=>r(),children:n(re,{})}),n(k,{variant:"h6",component:"div",sx:{flexGrow:1},children:"OBS Web remote"}),n(A,{color:"inherit",onClick:()=>t(),children:e==="connected"?"Disconnect":"Connect"})]})})}),u=new oe,E={version:"2",ip:window.location.hostname,port:4455,password:"",connectOnStartup:!1,preview:!0,refreshInterval:5},J=e=>{localStorage.setItem("settings",JSON.stringify(e))},be=()=>{try{const e=localStorage.getItem("settings");if(e){let t=JSON.parse(e);switch(t.version){case"1.0":t=i(s(s({},E),t),{version:E.version}),console.info(`Settings will be interpreted with v${E.version} defaults added`);break;case"2":return t;default:throw console.error("What's up with settings:",e),new Error("Could not parse stored settings")}return t}else return console.warn("No stored settings, making defaults"),J(E),E}catch{return console.warn("Unable to load settings, using defaults"),E}},G={connection:"disconnected",error:void 0,scenes:[],activeSceneName:"",settings:be(),transition:{duration:0,from:void 0,to:void 0}},Ie=(e,t)=>{switch(t.type){case"connectionError":return i(s({},e),{error:t.payload.message});case"connecting":return i(s({},e),{connection:"connecting"});case"connected":{console.log("CONNECTED",t);const{scenes:r,activeSceneName:a,transition:o}=t.payload;return u.call("GetVersion"),i(s({},e),{connection:"connected",error:void 0,scenes:r,activeSceneName:a,transition:o})}case"disconnected":return i(s({},G),{connection:"disconnected"});case"currentSceneChanged":{const{newSceneName:r}=t.payload;return r!==e.activeSceneName?i(s({},e),{activeSceneName:t.payload.newSceneName}):e}case"transitionDurationChanged":return i(s({},e),{transition:i(s({},e.transition),{duration:e.transition.duration})});case"selectScene":{const{sceneName:r}=t.payload;return u.call("SetCurrentProgramScene",{sceneName:r}),i(s({},e),{activeSceneName:r,transition:i(s({},e.transition),{from:e.activeSceneName,to:r})})}case"transitionStarted":return e.activeSceneName!==e.transition.from?i(s({},e),{transition:i(s({},e.transition),{from:e.activeSceneName})}):e;case"transitionCompleted":{const{from:r,to:a}=e.transition;return r||a?i(s({},e),{transition:i(s({},e.transition),{from:void 0,to:void 0})}):e}case"setSceneItemEnabled":return u.call("SetSceneItemEnabled",t.payload),e;case"updateSceneItems":{const{sceneName:r,items:a}=t.payload,o=e.scenes.find(l=>l.name===r);if(!o)throw new Error(`Could not update scene ${r}`);const c=e.scenes.map(l=>l.id===o.id?i(s({},o),{items:a}):l);return i(s({},e),{scenes:c})}case"updateSceneItemEnabled":{const{sceneName:r,sceneItemId:a,sceneItemEnabled:o}=t.payload,c=e.scenes.map(l=>l.name===r?i(s({},l),{items:l.items.map(S=>S.id===a?i(s({},S),{enabled:o}):S)}):l);return i(s({},e),{scenes:c})}case"updateSettings":{const{settings:r}=t.payload;return J(r),u.disconnect(),i(s({},G),{settings:r})}default:throw new Error(`Unhandled action type: ${t}`)}},xe=({enabled:e,currentImage:t,refreshInterval:r})=>{const a=g.exports.useRef(null),o=g.exports.useRef(-1),c=g.exports.useCallback(l=>{var b,d;if(!l.length){console.info("Can't get screenshot without an activeSceneName");return}const S=(d=(b=a.current)==null?void 0:b.width)!=null?d:window.innerWidth/2;u.call("GetSourceScreenshot",{sourceName:l,imageFormat:"png",imageWidth:S}).then(({imageData:f})=>{var y;return(y=a.current)==null?void 0:y.setAttribute("src",f)})},[a]);return g.exports.useEffect(()=>{if(t&&c(t),o.current===-1&&r>0)return console.info("Start a timer"),o.current=window.setInterval(()=>t&&c(t),r*1e3),()=>{clearInterval(o.current),o.current=-1}},[t,r,o,c]),e?n(B,{children:n("img",{ref:a,alt:"Preview",style:{display:"inline-block",width:"100%",background:"#00000022"}})}):n(B,{})},Ee=({name:e,items:t,onSceneItemEnabledClick:r})=>{const a=e;return n(V,{component:"div",disablePadding:!0,children:t.map(({id:o,name:c,enabled:l})=>h(C,{sx:{pl:4},children:[n(x,{onClick:()=>r({sceneName:a,sceneItemId:o,sceneItemEnabled:!l}),children:l?n(j,{color:"primary"}):n(q,{color:"error"})}),n(z,{primary:c})]},`sceneItem-${o}`))})},ke=({scenes:e,activeName:t,transition:r,onSceneClick:a,onSceneItemEnabledClick:o})=>{const[c,l]=g.exports.useState([]),{to:S,duration:b}=r,d=f=>{c.includes(f)?l(c.filter(y=>y!==f)):l([...c,f])};return h($,{item:!0,xs:12,md:6,children:[n(k,{sx:{mt:4,mb:2},variant:"h6",component:"div",children:"Scenes"}),n(V,{dense:!1,children:e.map(({id:f,name:y,items:N})=>{const O=t===y;c.includes(f);const p=n(ue,{edge:"start",tabIndex:-1,checked:O,onClick:v=>{v.stopPropagation(),a({sceneName:y})},disabled:!!S});return h(ce,{disableGutters:!0,children:[n(ae,{expandIcon:n(se,{onClick:()=>d(f)}),"aria-controls":"panel1a-content",id:"panel1a-header",children:h(I,{component:"div",disablePadding:!0,children:[n(x,{children:S&&S===y?n(ie,{in:!0,appear:!0,timeout:b,easing:{enter:"ease-in-out",exit:"ease-out"},children:p},f):p}),n(z,{children:n(k,{component:"div",children:y})})]})}),n(le,{style:{backgroundColor:"#f3f2f3"},children:n(de,{children:n(Ee,{name:y,items:N,onSceneItemEnabledClick:o})})})]},f)})})]})},Ne=({settings:e,onSettingsChanged:t,onClose:r})=>{const[a,o]=g.exports.useState(e),[c,l]=g.exports.useState(e.connectOnStartup),[S,b]=g.exports.useState(e.preview);return n(M,{sx:{pt:4,pb:4},children:h(V,{children:[n(C,{children:h(k,{variant:"h6",component:"div",children:["Version: ",{}.APP_VERSION]})}),n(C,{children:n(k,{variant:"h5",component:"div",children:"Settings"})}),h(C,{children:[n(x,{children:n(pe,{})}),n(I,{children:n(L,{id:"outlined",label:"IP/Hostname",defaultValue:e.ip,onChange:d=>o(i(s({},a),{ip:d.currentTarget.value}))})})]}),h(C,{children:[n(x,{children:n(he,{})}),n(I,{children:n(L,{label:"Port",defaultValue:e.port,onChange:d=>o(i(s({},a),{port:parseInt(d.currentTarget.value)}))})})]}),h(C,{children:[n(x,{children:n(me,{})}),n(I,{children:n(L,{label:"Password",defaultValue:e.password,onChange:d=>o(i(s({},a),{password:d.currentTarget.value}))})})]}),n(_,{}),h(C,{children:[n(x,{children:n(F,{checked:c,onChange:d=>l(d.target.checked)})}),n(I,{children:"Connect on Startup"})]}),h(C,{children:[n(x,{children:n(F,{checked:S,onChange:d=>b(d.target.checked)})}),n(I,{children:"Preview"})]}),S&&h(C,{children:[n(x,{children:n(fe,{})}),n(I,{children:n(L,{type:"number",label:"Refresh Interval",defaultValue:e.refreshInterval,onChange:d=>{const f=parseInt(d.currentTarget.value);if(f<0){alert("This number must be greater than 1 or 0 for no updates"),o(i(s({},a),{refreshInterval:f}));return}o(i(s({},a),{refreshInterval:parseInt(d.currentTarget.value)}))}})})]}),n(_,{}),n(I,{children:h($,{container:!0,spacing:2,children:[n($,{item:!0,xs:6,children:n(A,{variant:"outlined",color:"error",onClick:()=>r(),children:"Reset"})}),n($,{item:!0,xs:6,children:n(A,{variant:"contained",color:"primary",onClick:()=>t(i(s({},a),{connectOnStartup:c,preview:S})),children:"Save"})})]})})]})})};class Oe extends H.Component{constructor(t){super(t);this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}render(){return this.state.hasError?n("h1",{children:"Something went wrong."}):this.props.children}}const Pe=()=>{const[e,t]=g.exports.useReducer(Ie,G),[r,a]=g.exports.useState(!1),{error:o}=e,c=["EW/ATV Fullscreen"],l="EW/ATV",S=()=>{const p=[];return e.scenes.forEach(v=>{if(c.includes(v.name))return!1;{const m=v.items.find(w=>l===w.name);m&&p.push({sceneName:v.name,sceneItemId:m.id,enabled:m.enabled})}}),p},b=()=>{S().forEach(({sceneName:p,sceneItemId:v})=>u.call("SetSceneItemEnabled",{sceneName:p,sceneItemId:v,sceneItemEnabled:r})),a(!r)},d=g.exports.useCallback(()=>{(async()=>{t({type:"connecting"});const{ip:p,port:v,password:m}=e.settings;console.log("Let's go!!!");try{const{obsWebSocketVersion:w}=await u.connect(`ws://${p}:${v}/`,m);console.log(`Connected to server ${w}`)}catch(w){console.error(w),t({type:"connectionError",payload:{message:`Could not connect to ${p} on ${v}. Message: ${w}`}})}})()},[e,t]),f=g.exports.useCallback(()=>(async()=>{await u.disconnect(),t({type:"disconnected"})})(),[t]),y=g.exports.useCallback(()=>{e.connection==="connected"?f():d()},[e,d,f]);g.exports.useEffect(()=>{e.settings.connectOnStartup&&d();const p=async m=>{const{sceneItems:w}=await u.call("GetSceneItemList",{sceneName:m});return(await Promise.all(w.map(async({sourceName:D,sceneItemId:P,sceneItemIndex:T})=>({id:P,index:T,name:D,enabled:(await u.call("GetSceneItemEnabled",{sceneName:m,sceneItemId:P})).sceneItemEnabled})))).reverse()},v=async()=>{const{currentProgramSceneName:m,scenes:w}=await u.call("GetSceneList"),D=(await Promise.all(w.map(async({sceneName:T,sceneIndex:U})=>({id:U,name:T,items:await p(T)})))).reverse(),{transitionDuration:P}=await u.call("GetCurrentSceneTransition");t({type:"connected",payload:{scenes:D,activeSceneName:m,transition:{duration:P,from:void 0,to:void 0}}})};u.on("Identified",async()=>v()),u.on("CurrentProgramSceneChanged",({sceneName:m})=>{t({type:"currentSceneChanged",payload:{newSceneName:m}}),p(m)}),u.on("SceneItemEnableStateChanged",m=>t({type:"updateSceneItemEnabled",payload:m})),u.on("SceneTransitionStarted",()=>t({type:"transitionStarted"})),u.on("SceneTransitionEnded",()=>t({type:"transitionCompleted"})),u.on("CurrentSceneTransitionDurationChanged",({transitionDuration:m})=>t({type:"transitionDurationChanged",payload:{duration:m}})),u.on("SceneListChanged",()=>v()),u.on("ExitStarted",()=>t({type:"disconnected"}))},[]);const[N,O]=g.exports.useState(!1);return h(Oe,{children:[n(Ce,{connection:e.connection,onConnectClick:y,onMenuClick:()=>O(!N)}),n(Se,{anchor:"left",open:N,children:n(Ne,{settings:e.settings,onClose:()=>O(!N),onSettingsChanged:p=>{O(!1),t({type:"updateSettings",payload:{settings:p}})}})}),h(ge,{sx:{mt:4,mb:4},children:[o&&n(ve,{variant:"filled",severity:"error",children:o}),e.connection==="connected"?h(B,{children:[n(xe,{enabled:e.settings.preview,currentImage:e.activeSceneName,refreshInterval:e.settings.refreshInterval}),h(A,{variant:"contained",color:r?"error":"primary",onClick:()=>b(),children:[r?n(q,{}):n(j,{})," ","Overlays ",r?"off":"on"]}),n(ke,{scenes:e.scenes,activeName:e.activeSceneName,transition:e.transition,onSceneClick:p=>t({type:"selectScene",payload:p}),onSceneItemEnabledClick:p=>t({type:"setSceneItemEnabled",payload:p})})]}):n(k,{variant:"h4",component:"div",sx:{flexGrow:1},children:e.connection==="connecting"?"Connecting...":"Not Connected"})]})]})};ye.render(n(H.StrictMode,{children:n(Pe,{})}),document.getElementById("root"));
